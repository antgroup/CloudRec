"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1374],{24163:function(se,B,t){var H=t(97857),C=t.n(H),z=t(25593),_=t(83062),J=t(62435),h=t(86074),ee=z.Z.Paragraph;B.Z=function(c){var S=c.text,Q=c.width,j=c.maxWidth,N=c.rows,W=N===void 0?2:N,m=c.placement,r=m===void 0?"top":m,$=c.color,V=$===void 0?"rgba(0, 0, 0, 0.88)":$,x=c.link,v=x===void 0?!1:x,g=c.onClickCallBackFunc,L=c.style,D=L===void 0?{}:L,I=c.copyable,P=I===void 0?!1:I;return(0,h.jsx)("div",{style:{maxWidth:j,width:Q},children:(0,h.jsx)(_.Z,{title:(0,h.jsx)("div",{children:S}),placement:r,children:(0,h.jsx)(ee,{ellipsis:{rows:W},style:C()({marginBottom:0,color:V,cursor:v?"pointer":""},D),onClick:g,copyable:P,children:S})})})}},77603:function(se,B,t){t.d(B,{Z:function(){return ze}});var H=t(97857),C=t.n(H),z=t(15009),_=t.n(z),J=t(99289),h=t.n(J),ee=t(5574),c=t.n(ee),S=t(29297),Q=t(55375),j=t(45830),N=t(85265),W=t(96486),m=t(62435),r=t(86074),$=function(E){var w=E.whiteListInstanceVisible,p=E.whiteListInstanceInfo,Y=E.setWhiteListInstanceVisible,F=(0,m.useState)(""),U=c()(F,2),R=U[0],O=U[1],M=(0,j.useIntl)(),K=function(){Y(!1),O("")},ie=function(){K()};return(0,m.useEffect)(function(){if(w&&!(0,W.isEmpty)(p)){var G=JSON.stringify(p==null?void 0:p.outputEditor,null,4);(0,W.isEmpty)(G)||O(G)}},[w]),(0,r.jsx)(N.Z,{title:M.formatMessage({id:"common.message.text.execute.detail"}),width:"42%",destroyOnClose:!0,open:w,onClose:ie,children:!(0,W.isEmpty)(R)&&(0,r.jsx)(S.q9,{editorKey:"assetInstance",value:R,readOnly:!0,editorStyle:{height:"100%"}})})},V=$,x=t(96655),v=t(29448),g=t(93410),L=t(50727),D=t(97462),I=t(5966),P=t(97269),Oe=t(1413),Se=t(91),We=t(58055),we=["fieldProps","request","params","proFieldProps"],ke=function(E,w){var p=E.fieldProps,Y=E.request,F=E.params,U=E.proFieldProps,R=(0,Se.Z)(E,we);return(0,r.jsx)(We.Z,(0,Oe.Z)({valueType:"segmented",fieldProps:p,ref:w,request:Y,params:F,filedConfig:{customLightMode:!0},proFieldProps:U},R))},Ze=m.forwardRef(ke),Ae=Ze,Be=t(90672),Ne=t(64317),Ue=t(25593),Ke=t(68872),ce=t(71230),te=t(15746),X=t(83622),ve=t(86250),$e=t(57381),Ve=t(99859),b=t(68431),re={regoWrap:"regoWrap___iVxod",regoMain:"regoMain___eJpHo",customTitle:"customTitle___SrGFZ"},fe=Ue.Z.Title,me="506px",Ge=600,He=function(E){var w=(0,j.useModel)("rule"),p=w.whiteListConfigList,Y=w.allRuleList,F=E.editDrawerVisible,U=E.setEditDrawerVisible,R=E.whiteListDrawerInfo,O=E.tableActionRef,M=R.id,K=R.riskId,ie=R.isEditMode,G=ie===void 0?!0:ie,Je=(R==null?void 0:R.isLockHolder)||!1,y=!G,Qe=(0,m.useState)(!1),he=c()(Qe,2),Xe=he[0],pe=he[1],Ye=Ke.ZP.useMessage(),xe=c()(Ye,2),q=xe[0],qe=xe[1],l=(0,j.useIntl)(),k=(0,m.useRef)(),et=(0,m.useRef)(),tt=(0,m.useState)([]),ye=c()(tt,2),rt=ye[0],oe=ye[1],ne=(0,m.useRef)(),it=(0,m.useState)(!1),Ce=c()(it,2),nt=Ce[0],Ee=Ce[1],st=(0,m.useState)(!1),Re=c()(st,2),ot=Re[0],Le=Re[1],lt=(0,m.useState)(b.wo),De=c()(lt,2),le=De[0],_e=De[1],at=(0,m.useState)(""),Ie=c()(at,2),be=Ie[0],ae=Ie[1],Me=(0,m.useRef)({outputEditor:""}),ut=function(e){_e(e)},dt=function(e){ae(e)},ct=function(){var e;ae(""),(e=k.current)===null||e===void 0||e.resetFields()},ue=function(){U(!1)},vt=function(){var o=h()(_()().mark(function e(){var i,n,s,a;return _()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return pe(!0),i={id:M},f.next=4,(0,x.queryWhiteRuleGrabLock)(i);case 4:n=f.sent,pe(!1),n.code===200&&(q.success(l.formatMessage({id:"common.message.text.edit.success"})),R&&(R.isEditMode=!0,R.isLockHolder=!0),M&&Te(M),O==null||(s=O.current)===null||s===void 0||(a=s.reloadAndRest)===null||a===void 0||a.call(s));case 7:case"end":return f.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),ft=function(){var o=h()(_()().mark(function e(i){var n,s,a,u;return _()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return Ee(!0),n=C()(C()({},(0,b.Lg)(i)),{},{regoContent:le}),M&&(n.id=M),K&&(n.enable=1),d.next=6,(0,x.querySaveOrUpdateWhiteRule)(n);case 6:s=d.sent,Ee(!1),s.code===200&&s.msg==="success"&&(M?q.success(l.formatMessage({id:"common.message.text.edit.success"})):q.success(l.formatMessage({id:"common.message.text.add.success"})),U(!1),O==null||(a=O.current)===null||a===void 0||(u=a.reloadAndRest)===null||u===void 0||u.call(a));case 9:case"end":return d.stop()}},e)}));return function(i){return o.apply(this,arguments)}}(),mt=(0,j.useRequest)(function(o){return(0,x.queryWhiteListRuleExampleData)({riskRuleCode:o})},{manual:!0,formatResult:function(e){if(e.msg==="success"){var i=e.content;try{ae(JSON.stringify(C()({},i),null,4)||"")}catch(n){console.info("Error",n)}}}}),de=mt.run,je=(0,j.useRequest)(function(o){return(0,x.queryWhiteListRuleById)({id:o})},{manual:!0,formatResult:function(e){var i=e.content;return(0,b.OV)(i)||{}},onSuccess:function(e){var i,n=e.condition,s=e.ruleType,a=e.ruleName,u=e.ruleDesc,f=e.ruleConfigList,d=e.editableKeyList,T=e.riskRuleCode,Z=e.regoContent;(i=k.current)===null||i===void 0||i.setFieldsValue({ruleType:s,ruleName:a,ruleDesc:u,ruleConfigList:f,condition:n,riskRuleCode:T}),_e(Z),oe(d),s===b.sN[1].value&&de(T)}}),Te=je.run,gt=je.loading,Pe=(0,j.useRequest)(function(o){return(0,x.queryWhitedContentByRiskId)(o)},{manual:!0,formatResult:function(e){return(0,b.e$)(e==null?void 0:e.content)||{}},onSuccess:function(e){var i,n=e.condition,s=e.ruleType,a=e.ruleName,u=e.ruleDesc,f=e.ruleConfigList,d=e.editableKeyList,T=e.riskRuleCode;(i=k.current)===null||i===void 0||i.setFieldsValue({ruleType:s,ruleName:a,ruleDesc:u,ruleConfigList:f,condition:n,riskRuleCode:T}),oe(d)}}),ht=Pe.run,pt=Pe.loading;(0,m.useEffect)(function(){F&&M?Te(M):F&&K?ht({riskId:K}):F||ct()},[F]);var xt=function(e){if(e===b.sN[1].value){var i;de((i=k.current)===null||i===void 0?void 0:i.getFieldValue("riskRuleCode"))}},Fe=function(){var o=h()(_()().mark(function e(){var i,n,s,a,u;return _()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s=C()(C()({},(0,b.Lg)(((i=k.current)===null||i===void 0?void 0:i.getFieldsValue())||{})),{},{regoContent:le}),((n=k.current)===null||n===void 0?void 0:n.getFieldValue("ruleType"))===b.sN[1].value&&(s.input=be),a=q.loading(l.formatMessage({id:"common.message.text.execute.loading"})),d.next=5,(0,x.queryWhiteListTestRun)(s);case 5:u=d.sent,a(),u.code===200&&(Me.current.outputEditor=u.content,Le(!0),q.success(l.formatMessage({id:"common.message.text.execute.success"})));case 8:case"end":return d.stop()}},e)}));return function(){return o.apply(this,arguments)}}(),yt=[{title:l.formatMessage({id:"involve.extend.title.serial.number"}),dataIndex:"id",editable:!1,width:100,align:"center",render:function(e,i,n){return n+1}},{title:l.formatMessage({id:"rule.module.text.variable.name"}),dataIndex:"key",formItemProps:{rules:[{required:!0}]},valueType:"select",fieldProps:function(e,i){var n=i.rowIndex,s=(p==null?void 0:p.map(function(a){return{label:a.keyName,value:a.key}}))||[];return{options:s,allowClear:!1,onSelect:function(){var u,f;(u=ne.current)===null||u===void 0||(f=u.setRowData)===null||f===void 0||f.call(u,n,{operator:void 0,value:void 0})}}}},{title:l.formatMessage({id:"involve.extend.title.condition"}),dataIndex:"operator",formItemProps:{rules:[{required:!0}]},valueType:"select",fieldProps:function(e,i){var n,s,a,u=i.rowIndex;if(y)return{options:[]};var f=(n=ne.current)===null||n===void 0||(s=n.getRowData)===null||s===void 0||(s=s.call(n,u))===null||s===void 0?void 0:s.key;if(!f)return[];var d=p==null?void 0:p.find(function(Z){return Z.key===f}),T=d==null||(a=d.operatorList)===null||a===void 0?void 0:a.map(function(Z){return{label:Z,value:Z}});return{options:T||[]}}},{title:l.formatMessage({id:"rule.module.text.variable.value"}),dataIndex:"value",formItemProps:{rules:[{required:!0}]},valueType:function(e){var i;return(i=["resourceId","ip","resourceName"])!==null&&i!==void 0&&i.includes(e==null?void 0:e.key)?"text":"select"},fieldProps:function(e,i){var n,s,a,u,f=i.rowIndex;if(y)return{options:[]};var d=(n=ne.current)===null||n===void 0||(s=n.getRowData)===null||s===void 0||(s=s.call(n,f))===null||s===void 0?void 0:s.key;if((a=["resourceId","ip","resourceName"])!==null&&a!==void 0&&a.includes(d))return{};if(!d)return[];var T=p==null?void 0:p.find(function(A){return A.key===d}),Z=T==null||(u=T.value)===null||u===void 0?void 0:u.map(function(A){return{label:A==null?void 0:A.valueName,value:A==null?void 0:A.value}});return{showSearch:!0,options:Z||[]}}},{title:l.formatMessage({id:"cloudAccount.extend.title.cloud.operate"}),valueType:"option",width:140,render:function(){return[]}}],Ct=function(){return(0,r.jsxs)(g.Z,{style:{marginBottom:20},bodyStyle:{backgroundColor:"rgb(245, 245, 245)",padding:"0 20px 16px 20px"},children:[(0,r.jsx)(L.Z,{rowKey:"idx",name:"ruleConfigList",actionRef:et,editableFormRef:ne,headerTitle:(0,r.jsx)("div",{style:{fontSize:14},children:l.formatMessage({id:"involve.extend.title.conditional.config"})}),recordCreatorProps:y?void 0:{creatorButtonText:l.formatMessage({id:"involve.extend.title.addRowConfig"}),record:function(){return{idx:(Math.random()*1e6).toFixed(0)}}},onChange:function(){var i;return(i=k.current)===null||i===void 0?void 0:i.setFieldValue("condition",void 0)},columns:yt,editable:y?void 0:{type:"multiple",editableKeys:rt,onChange:oe,actionRender:function(i,n,s){return[s.delete]}}}),(0,r.jsx)(D.Z,{name:["ruleConfigList"],children:function(i){var n=i.ruleConfigList;return(0,r.jsxs)(ce.Z,{children:[(0,r.jsx)(te.Z,{span:14,children:(0,r.jsx)(I.Z,{label:l.formatMessage({id:"involve.extend.title.logical"}),name:"condition",fieldProps:{placeholder:l.formatMessage({id:"involve.extend.title.logical.example"})},rules:[{required:(n==null?void 0:n.length)>1}],disabled:y})}),(0,r.jsx)(te.Z,{children:(0,r.jsx)(X.ZP,{type:"link",style:{paddingRight:0,marginBottom:24},onClick:Fe,children:l.formatMessage({id:"common.button.text.test"})})})]})}})]})},Et=function(){return(0,r.jsx)("div",{className:re.regoWrap,children:(0,r.jsxs)(ce.Z,{className:re.regoMain,gutter:16,children:[(0,r.jsxs)(te.Z,{md:14,span:24,children:[(0,r.jsx)(fe,{level:5,className:re.customTitle,style:{marginBottom:16},children:"The Rego PlayGround"}),(0,r.jsx)(S.mi,{editorKey:"WHITE_LIST_REGO_EDITOR",value:le,onChange:ut,editorStyle:{height:me},readOnly:y})]}),(0,r.jsxs)(te.Z,{md:10,span:24,children:[(0,r.jsx)(fe,{level:5,className:re.customTitle,children:(0,r.jsxs)(ve.Z,{justify:"space-between",align:"center",children:[(0,r.jsx)("span",{children:"INPUT"}),(0,r.jsx)(X.ZP,{type:"link",style:{paddingRight:0},onClick:Fe,disabled:y,children:l.formatMessage({id:"common.button.text.test"})})]})}),(0,r.jsx)(S.q9,{editorStyle:{height:me},editorKey:"WHITE_LIST_INPUT_EDITOR",value:be,onChange:dt,readOnly:y})]})]})})};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(N.Z,{title:M?y?l.formatMessage({id:"common.button.text.view"})+l.formatMessage({id:"rule.extend.text.whiteList.title"}):l.formatMessage({id:"rule.extend.title.edit.whiteList"}):l.formatMessage({id:"rule.module.text.createWhiteList"}),width:"64%",destroyOnClose:!0,open:F,onClose:ue,styles:{body:{paddingBottom:52}},children:[qe,(0,r.jsxs)($e.Z,{spinning:gt||pt,children:[M&&!Je&&(0,r.jsxs)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#fff7e6",border:"1px solid #ffd591",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("span",{style:{color:"#d46b08"},children:l.formatMessage({id:"rule.message.not.holding.lock"})}),(0,r.jsx)(X.ZP,{type:"primary",size:"small",loading:Xe,onClick:vt,children:l.formatMessage({id:"rule.table.columns.text.grab.lock"})})]}),(0,r.jsxs)(P.A,{onFinish:ft,formRef:k,layout:"horizontal",submitter:{submitButtonProps:{loading:nt,disabled:y},render:function(e,i){return(0,r.jsx)(ve.Z,{justify:"end",gap:"small",children:y?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(X.ZP,{onClick:function(){return ue()},children:l.formatMessage({id:"common.button.text.close"})})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(X.ZP,{onClick:function(){return ue()},children:l.formatMessage({id:"common.button.text.cancel"})}),i]})})}},children:[(0,r.jsx)(Ae,{name:"ruleType",label:l.formatMessage({id:"rule.extend.text.whiteList.type"}),initialValue:b.sN[0].value,valueEnum:(0,v.W_)(b.sN),formItemProps:{rules:[{required:!0,message:l.formatMessage({id:"rule.extend.text.select.whiteList.type"})}]},fieldProps:{onChange:xt},disabled:y}),(0,r.jsx)(I.Z,{label:l.formatMessage({id:"rule.extend.text.whiteList.title"}),name:"ruleName",formItemProps:{rules:[{required:!0}]},disabled:y}),(0,r.jsx)(Be.Z,{label:l.formatMessage({id:"rule.extend.text.whiteList.describe"}),name:"ruleDesc",formItemProps:{rules:[{required:!1}]},disabled:y}),(0,r.jsx)(D.Z,{name:["ruleType"],children:function(e){var i=e.ruleType;return(0,r.jsx)(Ne.Z,{label:l.formatMessage({id:"rule.extend.text.risk.rule.code"}),disabled:!!K||y,name:"riskRuleCode",formItemProps:{rules:[{required:!1}]},options:Y||[],fieldProps:{showSearch:!0,filterOption:!0,onChange:(0,W.debounce)(function(n){i===b.sN[1].value&&de(n)},Ge)}})}}),(0,r.jsx)(D.Z,{name:["ruleType"],children:function(e){var i=e.ruleType;return i===b.sN[1].value?Et():Ct()}}),K&&(0,r.jsx)(Ve.Z.Item,{children:(0,r.jsx)("div",{style:{color:Q.KC,fontSize:"13px"},children:"* \u767D\u540D\u5355\u63D0\u4EA4\u540E\u5C06\u6267\u884C\u98CE\u9669\u626B\u63CF\uFF08\u9884\u8BA130\u5206\u949F\u751F\u6548\uFF09\uFF0C\u8BF7\u52FF\u91CD\u590D\u63D0\u4EA4"})})]})]})]}),(0,r.jsx)(V,{whiteListInstanceVisible:ot,setWhiteListInstanceVisible:Le,whiteListInstanceInfo:Me.current})]})},ze=He},68431:function(se,B,t){t.d(B,{Lg:function(){return W},OV:function(){return m},e$:function(){return r},sN:function(){return N},wo:function(){return $}});var H=t(97857),C=t.n(H),z=t(13769),_=t.n(z),J=t(45830),h=t(96486),ee=t.n(h),c=t(86074),S=["idx"],Q=["id"],j=["id"],N=[{label:(0,c.jsx)(J.FormattedMessage,{id:"rule.module.text.rule.engine"}),value:"RULE_ENGINE"},{label:(0,c.jsx)(J.FormattedMessage,{id:"rule.module.text.rule.rego"}),value:"REGO"}],W=function(x){var v=(0,h.cloneDeep)(x),g=v.ruleConfigList;return Array.isArray(g)&&!(0,h.isEmpty)(g)&&(v.ruleConfigList=g.map(function(L,D){var I=L.idx,P=_()(L,S);return C()(C()({},P),{},{id:D+1})})||[]),v},m=function(x){var v=(0,h.cloneDeep)(x),g=JSON.parse((0,h.cloneDeep)(v==null?void 0:v.ruleConfig))||[],L=[];return Array.isArray(g)&&!(0,h.isEmpty)(g)&&(v.ruleConfigList=(g==null?void 0:g.map(function(D){var I=D.id,P=_()(D,Q);return L.push(I),C()(C()({},P),{},{idx:I})}))||[]),v.editableKeyList=L,v},r=function(x){var v=(0,h.cloneDeep)(x),g=(0,h.cloneDeep)(v==null?void 0:v.ruleConfigList)||[],L=[];return Array.isArray(g)&&!(0,h.isEmpty)(g)&&(v.ruleConfigList=(g==null?void 0:g.map(function(D){var I=D.id,P=_()(D,j);return L.push(I),C()(C()({},P),{},{idx:I})}))||[]),v.editableKeyList=L,v},$=`package cloudrec_white_list

import rego.v1
  
default whited = false
  
whited if {
   input.method == "GET"
   input.path == "/public/resource"
}
`},53846:function(se,B){B.Z={customTitle:"customTitle___nzcxh",riskHigh:"riskHigh___GstO6",riskMedium:"riskMedium___F4JTb",riskLow:"riskLow___HJopw",imgProcess:"imgProcess___NGndv",imgResult:"imgResult___wKhiG",validTag:"validTag___TRSau",invalidTag:"invalidTag___opVlG",waitingTag:"waitingTag___JZpZT"}}}]);
